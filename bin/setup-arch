#!/bin/bash
# This script mostly sets up a new Arch Linux install.
set -eu

readonly packages=(
    acpi
    acpid
    acpilight
    base-devel
    ed
    emacs-wayland
    flatpak
    git
    github-cli
    gtk2 # for graphical pinentry
    go
    kmonad
    ibus
    inetutils
    netctl
    openssh
    parallel
    syncthing
    texinfo
    vi

    # Wayland
    adobe-source-code-pro-fonts
    alacritty
    dunst
    gammastep
    grim
    hyprland
    kanshi
    niri
    polkit-kde-agent
    rofi
    slurp
    swaybg
    swayidle
    swaylock
    waybar
    wl-clipboard
    xdg-desktop-portal-hyprland
    xdg-desktop-portal-wlr
    xwayland-satellite
)

readonly laptop=(
    dialog # for netctl wifi-menu
    iwd
    netctl
    tlp
)

main() {
    sudo pacman -S --noconfirm "${packages[@]}"
    systemctl --user enable waybar.service

    # Setup TLP
    # TODO: make this optional for laptops
    sudo pacman -S --noconfirm "${laptop[@]}"
    sudo systemctl enable tlp.service
    systemctl --user enable --now check-battery.timer

    # Untested
    # Setup perms for kmonad
    sudo groupadd --system uinput
    sudo usermod -aG input,uinput $USER
    sudo sh <<EOF
cat >/etc/udev/rules.d/10-uinput.rules <<FOE
KERNEL=="uinput", MODE="0660", GROUP="uinput", OPTIONS+="static_node=uinput"
FOE
EOF
    sudo systemctl restart systemd-udevd.service
    sudo modprobe uinput
}

main "$@"
